<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ajouter les cours dans son calendrier</title>
  </head>
  <body>
    <h1>Ajouter les cours dans son calendrier</h1>

    <form id="form">
      <label>
        Identifiant de l'école
        <input id="identifiant" type="text" />
      </label>

      <button type="submit">Valider</button>
    </form>

    <section class="url">
      <h2>URL à utiliser</h2>
      <div class="loading hidden">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          width="108px"
          height="108px"
          viewBox="0 0 100 100"
          preserveAspectRatio="xMidYMid"
        >
          <g transform="translate(50 50)">
            <g transform="matrix(1,0,0,1,0,0)">
              <path
                d="M28.91366458960192 -8 L39.91366458960192 -8 L39.91366458960192 8 L28.91366458960192 8 A30 30 0 0 1 26.101902549753255 14.78819405076849 L26.101902549753255 14.78819405076849 L33.88007714280528 22.56636864382051 L22.566368643820514 33.88007714280528 L14.788194050768492 26.101902549753255 A30 30 0 0 1 8.000000000000002 28.91366458960192 L8.000000000000002 28.91366458960192 L8.000000000000002 39.91366458960192 L-7.999999999999997 39.91366458960192 L-7.999999999999998 28.91366458960192 A30 30 0 0 1 -14.788194050768489 26.101902549753255 L-14.788194050768489 26.101902549753255 L-22.56636864382051 33.88007714280528 L-33.88007714280528 22.566368643820518 L-26.10190254975325 14.788194050768494 A30 30 0 0 1 -28.91366458960192 8.000000000000004 L-28.91366458960192 8.000000000000004 L-39.91366458960192 8.000000000000005 L-39.91366458960192 -7.999999999999995 L-28.91366458960192 -7.9999999999999964 A30 30 0 0 1 -26.101902549753255 -14.788194050768489 L-26.101902549753255 -14.788194050768489 L-33.88007714280528 -22.56636864382051 L-22.566368643820518 -33.88007714280528 L-14.788194050768496 -26.10190254975325 A30 30 0 0 1 -8.000000000000007 -28.91366458960192 L-8.000000000000007 -28.91366458960192 L-8.000000000000009 -39.91366458960192 L7.999999999999992 -39.91366458960192 L7.999999999999995 -28.91366458960192 A30 30 0 0 1 14.788194050768487 -26.10190254975326 L14.788194050768487 -26.10190254975326 L22.566368643820507 -33.880077142805284 L33.88007714280527 -22.56636864382052 L26.10190254975325 -14.788194050768498 A30 30 0 0 1 28.913664589601918 -8.000000000000009 M0 -11A11 11 0 1 0 0 11 A11 11 0 1 0 0 -11"
                fill="#0a0a0a"
              ></path>
            </g>
          </g>
          <!-- generated by https://loading.io/ -->
        </svg>

        Chargement en cours... (peut prendre une trentaine de secondes)
      </div>
      <code id="url"></code>
    </section>

    <section class="how">
      <h2>Comment faire?</h2>
      <p>Pour Google Agenda</p>
      <ol>
        <li>Il faut être sur ordi</li>
        <li>Copiez l'URL</li>
        <li>
          <a
            href="https://calendar.google.com/calendar/u/0/r/settings/addbyurl"
            target="_blank"
          >
            Ajoutez un calendrier depuis une URL</a
          >
        </li>
        <li>Collez l'URL</li>
      </ol>
    </section>

    <script>
      document.getElementById("form").addEventListener("submit", (event) => {
        console.log("got submit")
        event.preventDefault()
        document.querySelector(".loading").classList.remove("hidden")
        const uid = document.getElementById("identifiant").value
        fetch(`/${uid}/url`)
          .then((response) => response.text())
          .catch((error) => "Erreur interne, réessayes plus tard")
          .then((text) => {
            if (text == "internal error")
              text = "Erreur interne, réessaye plus tard"
            document.getElementById("url").innerText = text
            document.querySelector(".loading").classList.add("hidden")
          })
      })
    </script>

    <style>
      .loading.hidden {
        display: none;
      }
      .loading:not(.hidden) + #url {
        display: none;
      }
      .loading {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .loading svg {
        animation: spin 1s linear infinite;
        height: 1.75em;
        width: 1.75em;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }

        to {
          transform: rotate(1turn);
        }
      }
    </style>
  </body>
</html>
